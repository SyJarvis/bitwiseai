## PE指令bit位映射详细说明

### 2.0 通用指令格式

所有PE指令使用64位指令字，通用格式如下：

------

### 2.1 基础算术指令bit位映射

#### **MOV指令** (opcode=0b000000)

| Bit位   | 名称    | 宽度 | 说明             | 编码值   |
| ------- | ------- | ---- | ---------------- | -------- |
| [59:54] | opcode  | 6    | 操作码           | 0b000000 |
| [41:40] | reserve | 2    | 保留位           | -        |
| [39:35] | ro      | 5    | 可选Ro寄存器地址 | 0~31     |
| [34:30] | rd      | 5    | 目标寄存器地址   | 0~31     |
| [4:0]   | rs      | 5    | 源寄存器地址     | 0~31     |

**功能**: `rd = rs` (寄存器移动)

------

#### **ADD指令** (opcode=0b000001)

| Bit位   | 名称            | 宽度 | 说明               | 编码值                      |
| ------- | --------------- | ---- | ------------------ | --------------------------- |
| [59:54] | opcode          | 6    | 操作码             | 0b000001                    |
| [53]    | sign0           | 1    | 左操作数(rs0)符号  | 0=无符号, 1=有符号          |
| [52]    | sign1           | 1    | 右操作数(rs1)符号  | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_rs0    | 2    | 左操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [49:48] | bitwidth_rs1    | 2    | 右操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [47]    | cs              | 1    | 进位保留 (32bit)   | 0=正常, 1=保留进位          |
| [46]    | addc_en         | 1    | 带进位加法使能     | 0=正常, 1=加上进位          |
| [41:40] | bitwidth_output | 2    | 输出位宽           | 00=8bit, 01=16bit, 10=32bit |
| [39:35] | ro              | 5    | 可选Ro寄存器地址   | 0~31                        |
| [34:30] | rd              | 5    | 目标寄存器地址     | 0~31                        |
| [14:10] | rs2             | 5    | 保留/扩展源寄存器  | 0~31                        |
| [9:5]   | rs1             | 5    | 右操作数寄存器地址 | 0~31                        |
| [4:0]   | rs0             | 5    | 左操作数寄存器地址 | 0~31                        |

**功能**: `rd = rs0 + rs1` (带饱和处理)

------

#### **SUB指令** (opcode=0b000010)

| Bit位   | 名称         | 宽度 | 说明               | 编码值                      |
| ------- | ------------ | ---- | ------------------ | --------------------------- |
| [59:54] | opcode       | 6    | 操作码             | 0b000010                    |
| [53]    | sign0        | 1    | 左操作数(rs0)符号  | 0=无符号, 1=有符号          |
| [52]    | sign1        | 1    | 右操作数(rs1)符号  | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_rs0 | 2    | 左操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [49:48] | bitwidth_rs1 | 2    | 右操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [47:42] | reserve      | 6    | 保留位             | -                           |
| [41:40] | reserve      | 2    | 保留位             | -                           |
| [39:35] | ro           | 5    | 可选Ro寄存器地址   | 0~31                        |
| [34:30] | rd           | 5    | 目标寄存器地址     | 0~31                        |
| [9:5]   | rs1          | 5    | 右操作数寄存器地址 | 0~31                        |
| [4:0]   | rs0          | 5    | 左操作数寄存器地址 | 0~31                        |

## **功能**: `rd = rs0 - rs1` (带饱和处理)

#### **MUL指令** (opcode=0b000011)

| Bit位   | 名称            | 宽度 | 说明                     | 编码值                                                 |
| ------- | --------------- | ---- | ------------------------ | ------------------------------------------------------ |
| [59:54] | opcode          | 6    | 操作码                   | 0b000011                                               |
| [53]    | sign0           | 1    | 左操作数(rs0)符号        | 0=无符号, 1=有符号                                     |
| [52]    | sign1           | 1    | 右操作数(rs1)符号        | 0=无符号, 1=有符号                                     |
| [51:50] | bitwidth_rs0    | 2    | 左操作数位宽             | 00=8bit, 01=16bit, 10=32bit                            |
| [49:48] | bitwidth_rs1    | 2    | 右操作数位宽             | 00=8bit, 01=16bit, 10=32bit                            |
| [47:42] | shift_width     | 6    | 右移位宽                 | 0~63                                                   |
| [41:40] | bitwidth_output | 2    | 输出位宽                 | 00=8bit, 01=16bit, 10=32bit                            |
| [39:35] | ro              | 5    | 可选Ro寄存器地址         | 0~31                                                   |
| [34:30] | rd0             | 5    | 目标寄存器0地址(低32bit) | 0~31                                                   |
| [29:25] | rd1             | 5    | 目标寄存器1地址(高32bit) | 0~31 (当输出>32bit时)                                  |
| [19:15] | func_sel        | 5    | 功能选择                 | bit[1:0]: 移位选择 (00=不移位, 01=右移, 10=由n_Bx决定) |
| [14:10] | rs2             | 5    | n_Bx寄存器地址           | 0~31                                                   |
| [9:5]   | rs1             | 5    | 右操作数寄存器地址       | 0~31                                                   |
| [4:0]   | rs0             | 5    | 左操作数寄存器地址       | 0~31                                                   |

**功能**: `rd0[rd1] = rs0 * rs1 >> shift_width` (支持位宽扩展，输出>32bit时用rd0+rd1)
两个操作数是否是有符号数还是无符号数可以任意指定,分别由bit[53]和bit[52]指定。两个操作数的位宽分别由bit[51:50]和bit[49:48]指定。输出位宽分别由bit[41:40]指定。当总输出位宽大于32bit时，需要由两个寄存器保存，其中rd0保存32低32bit，rd1保存高32bit. 支持的位宽组合如下图所示：
rs2指定n_Bx存放在哪个寄存器中。func_sel为附加功能，func_sel[1:0]为移位宽的选择，为00时表示不移位；为01时表示右移指定的位宽(右移后会饱和处理到输出位宽)，该位宽由指令的bit[47:42]表示；为10时，移位方向和位宽由n_Bx决定（n_Bx[6]表示移位方向，n_Bx[5:0]表示移位位宽），无论是右移还是左移，都需要饱和处理到输出位宽。

**乘法位宽支持表格**

| 行号 | 操作类型（位宽组合） | rs0 数据分布                                                 | rs1 数据分布                         | 结果位宽  | 结果存储方式                                                 | 说明                                                      |
| ---- | -------------------- | ------------------------------------------------------------ | ------------------------------------ | --------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| 1    | {32, 32} → 32        | rs0[31:0]                                                    | rs1[31:0]                            | 32bit     | rd0[31:0] = (rs0 × rs1)[31:0]                                | 标量 32×32，取低 32bit                                    |
| 2    | {32, 16} → 32        | 情况A：rs0[31:0]<br>情况B：rs0[15:0]                         | 情况A：rs1[15:0]<br>情况B：rs1[31:0] | 32bit     | rd0[31:0]                                                    | 支持 32×16 或 16×32；低位宽操作数取其低 16bit，扩展后相乘 |
| 3    | {32, 8} → 32         | 情况A：rs0[31:0]<br>情况B：rs0[7:0]                          | 情况A：rs1[7:0]<br>情况B：rs1[31:0]  | 32bit     | rd0[31:0]                                                    | 支持 32×8 或 8×32；8bit 操作数取最低字节，扩展后参与运算  |
| 4    | {16, 16} → 32        | rs0[15:0], rs0[31:16]                                        | rs1[15:0], rs1[31:16]                | 32bit × 2 | rd0 = low_ch_prod<br>rd1 = high_ch_prod                      | 双通道 16×16→32 并行；通道对齐相乘                        |
| 5    | {16, 16} → 16        | rs0[15:0], rs0[31:16]                                        | rs1[15:0], rs1[31:16]                | 16bit × 2 | rd0[15:0], rd0[31:16]                                        | 双通道 16×16→16，结果 pack 回 rd0                         |
| 6    | {16, 8} → 24         | 情况A：<br>rs0: 16bit 通道<br>rs1: 8bit 通道<br>情况B：<br>rs0: 8bit 通道<br>rs1: 16bit 通道 | 同左                                 | 24bit × 2 | rd0[23:0], rd1[23:0]                                         | 支持 16×8 或 8×16；每通道独立，高位清零                   |
| 7    | {16, 8} → 16         | 同上（可互换）                                               | 同上                                 | 16bit × 2 | rd0[15:0], rd0[31:16]                                        | 截断为 16bit，pack 到 rd0                                 |
| 8    | {8, 8} → 8           | rs0[7:0], [15:8], [23:16], [31:24]                           | rs1[7:0], [15:8], [23:16], [31:24]   | 8bit × 4  | rd0[7:0] ~ [31:24]                                           | 四通道 8×8→8，结果 pack 到 rd0                            |
| 9    | {8, 8} → 16          | rs0[7:0], [15:8], [23:16], [31:24]                           | rs1[7:0], [15:8], [23:16], [31:24]   | 16bit × 4 | rd0[15:0] = P0<br>rd0[31:16] = P1<br>rd1[15:0] = P2<br>rd1[31:16] = P3 | 四通道 8×8→16 并行；操作数可互换，因乘法交换律成立        |

🔹 符号说明：
{X, Y} 表示操作数位宽集合，顺序无关（即 X×Y 和 Y×X 均支持）。
“通道”指寄存器内按位宽划分的数据单元（如 32bit 寄存器含 4 个 8bit 通道）。
所有低位宽操作数（如 8bit、16bit）默认从对应寄存器的 最低有效位段 提取（如 [7:0]、[15:0]），除非用于多通道模式。

约束:
    1. 对于左操作数位宽+右操作数位宽大于输出位宽时，func_sel不能配成0，例如8bit*8bit=8bit（8+8>8），16bit*16bit=16bit, 32bit*32bit=32bit, 16*8=16bit, 32*8=32bit, 32*16=32bit，func_sel不能配成0
    2. 对于左操作数位宽+右操作数位宽小于等于输出位宽时，func_sel一定要配成0，例如8bit*16bit=32bit（8+16<32），16bit*16bit=32bit, 8bit*8bit=16bit，func_sel一定要配成0

##     3. 只有下面三种情况，func_sel可以配成2：8bit*16bit=16bit, 16*16bit=16bit， 32bit*32bit=32bit.

### 2.2 LUT系列指令bit位映射

#### **LUT2指令** (opcode=0b000110)

| Bit位   | 名称           | 宽度 | 说明                         | 编码值                      |
| ------- | -------------- | ---- | ---------------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码                       | 0b000110                    |
| [53]    | sign0          | 1    | 操作数符号                   | 0=无符号, 1=有符号          |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号                | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽                     | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | x-z_p结果寄存器              | 0~31                        |
| [29:25] | rd1            | 5    | 查询出的n_Bx存放的寄存器     | 0~31                        |
| [24:20] | rd2            | 5    | 查询出的q_b存放寄存器低32bit | 0~31                        |
| [19:15] | rd3            | 5    | 查询出的q_b存放寄存器高32bit | 0~31                        |
| [14:10] | rd4            | 5    | 查询出的term_c低32bit寄存器  | 0~31                        |
| [9:5]   | rd5            | 5    | 查询出的term_c高32bit寄存器  | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址                 | 0~31                        |

**功能**: LUT查表，主要功能是实现查表,并将表中的数据解析到rd1,rd2,rd3,rd4,rd5 中,然后实现计算 `x - z_p`, 将结果放到rd0

------

#### **LUT3指令** (opcode=0b000111)

| Bit位   | 名称           | 宽度 | 说明                         | 编码值                      |
| ------- | -------------- | ---- | ---------------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码                       | 0b000111                    |
| [53]    | sign0          | 1    | 操作数符号                   | 0=无符号, 1=有符号          |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号                | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽                     | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | x-z_p结果寄存器              | 0~31                        |
| [29:25] | rd1            | 5    | 查询出的n_Bx存放的寄存器     | 0~31                        |
| [24:20] | rd2            | 5    | 查询出的q_b存放寄存器低32bit | 0~31                        |
| [19:15] | rd3            | 5    | 查询出的q_b存放寄存器高32bit | 0~31                        |
| [14:10] | rd4            | 5    | 查询出的term_c低32bit寄存器  | 0~31                        |
| [9:5]   | rd5            | 5    | 查询出的term_c高32bit寄存器  | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址                 | 0~31                        |

**功能**: 同LUT2，使用LUT3表

------

#### **LUT4指令** (opcode=0b001000)

| Bit位   | 名称           | 宽度 | 说明                         | 编码值                      |
| ------- | -------------- | ---- | ---------------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码                       | 0b001000                    |
| [53]    | sign0          | 1    | 操作数符号                   | 0=无符号, 1=有符号          |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号                | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽                     | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | x-z_p结果寄存器              | 0~31                        |
| [29:25] | rd1            | 5    | 查询出的n_Bx存放的寄存器     | 0~31                        |
| [24:20] | rd2            | 5    | 查询出的q_b存放寄存器低32bit | 0~31                        |
| [19:15] | rd3            | 5    | 查询出的q_b存放寄存器高32bit | 0~31                        |
| [14:10] | rd4            | 5    | 查询出的term_c低32bit寄存器  | 0~31                        |
| [9:5]   | rd5            | 5    | 查询出的term_c高32bit寄存器  | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址                 | 0~31                        |

**功能**: 同LUT2，使用LUT4表(INT32模式)

------

#### **ABS_LUT2指令** (opcode=0b001001)

| Bit位   | 名称           | 宽度 | 说明                | 编码值                      |
| ------- | -------------- | ---- | ------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码              | 0b001001                    |
| [53]    | sign           | 1    | 操作数符号          | 1=有符号(必须)              |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号       | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽            | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | abs_x-z_p结果寄存器 | 0~31                        |
| [29:25] | rd1            | 5    | n_Bx结果寄存器      | 0~31                        |
| [24:20] | rd2            | 5    | q_b结果寄存器       | 0~31                        |
| [19:15] | rd3            | 5    | term_c低32bit寄存器 | 0~31                        |
| [14:10] | rd4            | 5    | term_c高32bit寄存器 | 0~31                        |
| [9:5]   | rd5            | 5    | abs_x结果寄存器     | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址        | 0~31                        |

**功能**: `abs_x = abs(rs)`, 然后对`abs_x`进行LUT查表

------

#### **ABS_LUT3指令** (opcode=0b001010)

| Bit位   | 名称           | 宽度 | 说明                | 编码值                      |
| ------- | -------------- | ---- | ------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码              | 0b001010                    |
| [53]    | sign           | 1    | 操作数符号          | 1=有符号(必须)              |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号       | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽            | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | abs_x-z_p结果寄存器 | 0~31                        |
| [29:25] | rd1            | 5    | n_Bx结果寄存器      | 0~31                        |
| [24:20] | rd2            | 5    | q_b结果寄存器       | 0~31                        |
| [19:15] | rd3            | 5    | term_c低32bit寄存器 | 0~31                        |
| [14:10] | rd4            | 5    | term_c高32bit寄存器 | 0~31                        |
| [9:5]   | rd5            | 5    | abs_x结果寄存器     | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址        | 0~31                        |

**功能**: 同ABS_LUT2，使用LUT3表

------

#### **ABS_LUT4指令** (opcode=0b001011)

| Bit位   | 名称           | 宽度 | 说明                | 编码值                      |
| ------- | -------------- | ---- | ------------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码              | 0b001011                    |
| [53]    | sign           | 1    | 操作数符号          | 1=有符号(必须)              |
| [52]    | sign1(z_p)     | 1    | 零点(z_p)符号       | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽            | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd0            | 5    | abs_x-z_p结果寄存器 | 0~31                        |
| [29:25] | rd1            | 5    | n_Bx结果寄存器      | 0~31                        |
| [24:20] | rd2            | 5    | q_b结果寄存器       | 0~31                        |
| [19:15] | rd3            | 5    | term_c低32bit寄存器 | 0~31                        |
| [14:10] | rd4            | 5    | term_c高32bit寄存器 | 0~31                        |
| [9:5]   | rd5            | 5    | abs_x结果寄存器     | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址        | 0~31                        |

**功能**: 同ABS_LUT2，使用LUT4表(INT32模式)

------

### 2.3 限幅与符号指令bit位映射

#### **CLAMP指令** (opcode=0b001100)

| Bit位   | 名称     | 宽度 | 说明             | 编码值                                                 |
| ------- | -------- | ---- | ---------------- | ------------------------------------------------------ |
| [59:54] | opcode   | 6    | 操作码           | 0b001100                                               |
| [53]    | sign     | 1    | 操作数符号       | 0=无符号, 1=有符号                                     |
| [51:50] | bitwidth | 2    | 左操作数位宽     | 00=8bit, 01=16bit, 10=32bit                            |
| [39:35] | ro       | 5    | 可选Ro寄存器地址 | 0~31                                                   |
| [34:30] | rd       | 5    | 目标寄存器地址   | 0~31                                                   |
| [9:5]   | val_sel  | 5    | CLAMP边界选择器  | 0=CLAMP_BND0, 1=CLAMP_BND1, 2=CLAMP_BND2, 3=CLAMP_BND3 |
| [4:0]   | rs0      | 5    | 源寄存器地址     | 0~31                                                   |

**功能**: `rd = clamp(rs0, min, max)` (min/max由val_sel选择的CLAMP_BND寄存器配置)

------

#### **CLAMP_LUT2指令** (opcode=0b001101)

| Bit位   | 名称            | 宽度 | 说明                  | 编码值                                                 |
| ------- | --------------- | ---- | --------------------- | ------------------------------------------------------ |
| [59:54] | opcode          | 6    | 操作码                | 0b001101                                               |
| [53]    | sign            | 1    | 操作数符号            | 1=有符号(必须)                                         |
| [52]    | sign1(z_p)      | 1    | 零点(z_p)符号         | 0=无符号, 1=有符号                                     |
| [51:50] | bitwidth_input  | 2    | 输入位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [47:42] | shift_width     | 6    | 右移位宽              | 0~63                                                   |
| [41:40] | bitwidth_output | 2    | 输出位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [39:35] | val_sel         | 5    | CLAMP边界选择器       | 0=CLAMP_BND0, 1=CLAMP_BND1, 2=CLAMP_BND2, 3=CLAMP_BND3 |
| [34:30] | rd0             | 5    | clamp_x-z_p结果寄存器 | 0~31                                                   |
| [29:25] | rd1             | 5    | n_Bx结果寄存器        | 0~31                                                   |
| [24:20] | rd2             | 5    | q_b结果寄存器         | 0~31                                                   |
| [19:15] | rd3             | 5    | term_c低32bit寄存器   | 0~31                                                   |
| [14:10] | rd4             | 5    | term_c高32bit寄存器   | 0~31                                                   |
| [9:5]   | rd5             | 5    | clamp_x结果寄存器     | 0~31                                                   |
| [4:0]   | rs0             | 5    | 源寄存器地址          | 0~31                                                   |

**功能**: `clamp_x = clamp(rs0, min, max)`, 然后对`clamp_x`进行LUT查表

------

#### **CLAMP_LUT3指令** (opcode=0b001110)

| Bit位   | 名称            | 宽度 | 说明                  | 编码值                                                 |
| ------- | --------------- | ---- | --------------------- | ------------------------------------------------------ |
| [59:54] | opcode          | 6    | 操作码                | 0b001110                                               |
| [53]    | sign            | 1    | 操作数符号            | 1=有符号(必须)                                         |
| [52]    | sign1(z_p)      | 1    | 零点(z_p)符号         | 0=无符号, 1=有符号                                     |
| [51:50] | bitwidth_input  | 2    | 输入位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [47:42] | shift_width     | 6    | 右移位宽              | 0~63                                                   |
| [41:40] | bitwidth_output | 2    | 输出位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [39:35] | val_sel         | 5    | CLAMP边界选择器       | 0=CLAMP_BND0, 1=CLAMP_BND1, 2=CLAMP_BND2, 3=CLAMP_BND3 |
| [34:30] | rd0             | 5    | clamp_x-z_p结果寄存器 | 0~31                                                   |
| [29:25] | rd1             | 5    | n_Bx结果寄存器        | 0~31                                                   |
| [24:20] | rd2             | 5    | q_b结果寄存器         | 0~31                                                   |
| [19:15] | rd3             | 5    | term_c低32bit寄存器   | 0~31                                                   |
| [14:10] | rd4             | 5    | term_c高32bit寄存器   | 0~31                                                   |
| [9:5]   | rd5             | 5    | clamp_x结果寄存器     | 0~31                                                   |
| [4:0]   | rs0             | 5    | 源寄存器地址          | 0~31                                                   |

**功能**: 同CLAMP_LUT2，使用LUT3表

------

#### **CLAMP_LUT4指令** (opcode=0b001111)

| Bit位   | 名称            | 宽度 | 说明                  | 编码值                                                 |
| ------- | --------------- | ---- | --------------------- | ------------------------------------------------------ |
| [59:54] | opcode          | 6    | 操作码                | 0b001111                                               |
| [53]    | sign            | 1    | 操作数符号            | 1=有符号(必须)                                         |
| [52]    | sign1(z_p)      | 1    | 零点(z_p)符号         | 0=无符号, 1=有符号                                     |
| [51:50] | bitwidth_input  | 2    | 输入位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [47:42] | shift_width     | 6    | 右移位宽              | 0~63                                                   |
| [41:40] | bitwidth_output | 2    | 输出位宽              | 00=8bit, 01=16bit, 10=32bit                            |
| [39:35] | val_sel         | 5    | CLAMP边界选择器       | 0=CLAMP_BND0, 1=CLAMP_BND1, 2=CLAMP_BND2, 3=CLAMP_BND3 |
| [34:30] | rd0             | 5    | clamp_x-z_p结果寄存器 | 0~31                                                   |
| [29:25] | rd1             | 5    | n_Bx结果寄存器        | 0~31                                                   |
| [24:20] | rd2             | 5    | q_b结果寄存器         | 0~31                                                   |
| [19:15] | rd3             | 5    | term_c低32bit寄存器   | 0~31                                                   |
| [14:10] | rd4             | 5    | term_c高32bit寄存器   | 0~31                                                   |
| [9:5]   | rd5             | 5    | clamp_x结果寄存器     | 0~31                                                   |
| [4:0]   | rs0             | 5    | 源寄存器地址          | 0~31                                                   |

**功能**: 同CLAMP_LUT2，使用LUT4表(INT32模式)

------

### 2.4 数学函数指令bit位映射

#### **ABS指令** (opcode=0b010000)

| Bit位   | 名称     | 宽度 | 说明             | 编码值                      |
| ------- | -------- | ---- | ---------------- | --------------------------- |
| [59:54] | opcode   | 6    | 操作码           | 0b010000                    |
| [53]    | sign     | 1    | 操作数符号       | 1=有符号(必须)              |
| [51:50] | bitwidth | 2    | 操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [39:35] | ro       | 5    | 可选Ro寄存器地址 | 0~31                        |
| [34:30] | rd       | 5    | 目标寄存器地址   | 0~31                        |
| [4:0]   | rs       | 5    | 源寄存器地址     | 0~31                        |

**功能**: `rd = abs(rs)` (绝对值)

------

#### **ACC指令** (opcode=0b010001)

| Bit位   | 名称           | 宽度 | 说明              | 编码值                      |
| ------- | -------------- | ---- | ----------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码            | 0b010001                    |
| [53]    | sign           | 1    | 操作数符号        | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input | 2    | 输入位宽          | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | Rm/R0          | 5    | PEx累加结果寄存器 | 通常为Rm                    |
| [4:0]   | rs             | 5    | 源寄存器地址      | 支持RI0, RI1, R0            |

**功能**: `Rm = sum(PE0.rs + PE1.rs + ... + PE127.rs)` (累加所有PE的寄存器值到PEx)

------

#### **SHIFT指令** (opcode=0b010010)

| Bit位   | 名称           | 宽度 | 说明             | 编码值                            |
| ------- | -------------- | ---- | ---------------- | --------------------------------- |
| [59:54] | opcode         | 6    | 操作码           | 0b010010                          |
| [53]    | sign           | 1    | 操作数符号       | 0=无符号, 1=有符号                |
| [52]    | dir            | 1    | 移位方向         | 0=右移, 1=左移                    |
| [51:50] | bitwidth_input | 2    | 输入位宽         | 00=8bit, 01=16bit, 10=32bit       |
| [49]    | SAT            | 1    | 饱和处理使能     | 0=不饱和, 1=饱和                  |
| [48:47] | RND            | 2    | 舍入方式         | 00=floor, 01=nearest, 1x=reserved |
| [46:42] | shift_width    | 5    | 移位宽度         | 0~31                              |
| [41:40] | reserve        | 2    | 保留位           | -                                 |
| [39:35] | ro             | 5    | 可选Ro寄存器地址 | 0~31                              |
| [34:30] | rd             | 5    | 目标寄存器地址   | 0~31                              |
| [4:0]   | rs             | 5    | 源寄存器地址     | 0~31                              |

**功能**: `rd = rs << shift_width` 或 `rd = rs >> shift_width` (带饱和/舍入)
约束:

##     操作数位宽为8bit,16bit时，左移固定支持饱和处理

#### **P_ABS_MUL1指令** (opcode=0b010011, 暂不支持)

| Bit位   | 名称            | 宽度 | 说明                            | 编码值                           |
| ------- | --------------- | ---- | ------------------------------- | -------------------------------- |
| [59:54] | opcode          | 6    | 操作码                          | 0b010011                         |
| [51:50] | bitwidth_input  | 2    | 输入位宽                        | 00=8bit, 01=16bit, 10=32bit      |
| [49]    | 取符号          | 1    | 是否取符号                      | 0=返回prod, 1=返回sign(rs1)*prod |
| [47:42] | shift_width     | 6    | 右移位宽                        | 0~63                             |
| [41:40] | bitwidth_output | 2    | 输出位宽                        | 00=8bit, 01=16bit, 10=32bit      |
| [39:35] | ro              | 5    | 可选Ro寄存器地址                | 0~31                             |
| [34:30] | rd0             | 5    | sign(rs1)*abs(rs0)*abs(rs0)结果 | 0~31                             |
| [29:25] | rd1             | 5    | abs(rs0)结果                    | 0~31                             |
| [9:5]   | rs1             | 5    | 符号参考寄存器地址              | 0~31                             |
| [4:0]   | rs0             | 5    | 源寄存器地址                    | 0~31                             |

**功能**: `rd0 = sign(rs1) * abs(rs0) * abs(rs0)`, `rd1 = abs(rs0)`

------

#### **P_ABS_MUL2指令** (opcode=0b010100, 暂不支持)

| Bit位   | 名称            | 宽度 | 说明                  | 编码值                      |
| ------- | --------------- | ---- | --------------------- | --------------------------- |
| [59:54] | opcode          | 6    | 操作码                | 0b010100                    |
| [47:42] | shift_width     | 6    | 右移位宽              | 0~63                        |
| [41:40] | bitwidth_output | 2    | 输出位宽              | 00=8bit, 01=16bit, 10=32bit |
| [39:35] | ro              | 5    | 可选Ro寄存器地址      | 0~31                        |
| [34:30] | rd0             | 5    | sign(rs2)*rs0*rs1结果 | 0~31                        |
| [19:15] | rs2             | 5    | 符号参考寄存器地址    | 0~31                        |
| [9:5]   | rs1             | 5    | 右操作数寄存器地址    | 0~31                        |
| [4:0]   | rs0             | 5    | 左操作数寄存器地址    | 0~31                        |

**功能**: `rd0 = sign(rs2) * rs0 * rs1`

------

#### **P_SIGN指令** (opcode=0b010101)

| Bit位   | 名称     | 宽度 | 说明               | 编码值                      |
| ------- | -------- | ---- | ------------------ | --------------------------- |
| [59:54] | opcode   | 6    | 操作码             | 0b010101                    |
| [51:50] | bitwidth | 2    | 操作数位宽         | 00=8bit, 01=16bit, 10=32bit |
| [47:42] | reserve  | 6    | 保留位             | -                           |
| [41:40] | reserve  | 2    | 保留位             | -                           |
| [39:35] | ro       | 5    | 可选Ro寄存器地址   | 0~31                        |
| [34:30] | rd       | 5    | 目标寄存器地址     | 0~31                        |
| [9:5]   | rs1      | 5    | 符号参考寄存器地址 | 0~31                        |
| [4:0]   | rs0      | 5    | 值寄存器地址       | 0~31                        |

**功能**: `rd = sign(rs1) * rs0` (符号乘法)

------

#### **MUL_IMM指令** (opcode=0b010110)

| Bit位   | 名称            | 宽度 | 说明              | 编码值                      |
| ------- | --------------- | ---- | ----------------- | --------------------------- |
| [59:54] | opcode          | 6    | 操作码            | 0b010110                    |
| [53]    | sign0           | 1    | 左操作数(rs0)符号 | 0=无符号, 1=有符号          |
| [52]    | sign1           | 1    | 右操作数(rs1)符号 | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input  | 2    | 输入位宽          | 00=8bit, 01=16bit, 10=32bit |
| [49:48] | bitwidth_output | 2    | 输出位宽          | 00=8bit, 01=16bit, 10=32bit |
| [47:42] | shift_width     | 6    | 右移位宽          | 0~63                        |
| [41:37] | rd              | 5    | 目标寄存器地址    | 0~31                        |
| [36:32] | rs1             | 5    | 源寄存器地址      | 0~31                        |
| [31:0]  | imm             | 32   | 立即数            | 0x00000000~0xFFFFFFFF       |

**功能**: `rd = imm * rs1 >> shift_width` (立即数乘法)

------

#### **ADD_IMM指令** (opcode=0b010111)

| Bit位   | 名称     | 宽度 | 说明              | 编码值                      |
| ------- | -------- | ---- | ----------------- | --------------------------- |
| [59:54] | opcode   | 6    | 操作码            | 0b010111                    |
| [53]    | sign0    | 1    | 左操作数(rs0)符号 | 0=无符号, 1=有符号          |
| [52]    | sign1    | 1    | 右操作数(rs1)符号 | 0=无符号, 1=有符号          |
| [51:50] | bitwidth | 2    | 操作数位宽        | 00=8bit, 01=16bit, 10=32bit |
| [41:37] | rd       | 5    | 目标寄存器地址    | 0~31                        |
| [36:32] | rs1      | 5    | 源寄存器地址      | 0~31                        |
| [31:0]  | imm      | 32   | 立即数            | 0x00000000~0xFFFFFFFF       |

**功能**: `rd = rs1 + imm` (立即数加法，输出位宽与输入相同)

------

### 2.5 立即数指令bit位映射

#### **MOV_IMM指令** (opcode=0b011000)

| Bit位   | 名称   | 宽度 | 说明           | 编码值                |
| ------- | ------ | ---- | -------------- | --------------------- |
| [59:54] | opcode | 6    | 操作码         | 0b011000              |
| [41:37] | rd     | 5    | 目标寄存器地址 | 0~31                  |
| [31:0]  | imm    | 32   | 立即数         | 0x00000000~0xFFFFFFFF |

**功能**: `rd = imm` (立即数加载)

------

#### **MULx_IMM指令** (opcode=0b011001, PEx专用)

| Bit位   | 名称            | 宽度 | 说明              | 编码值                      |
| ------- | --------------- | ---- | ----------------- | --------------------------- |
| [59:54] | opcode          | 6    | 操作码            | 0b011001                    |
| [53]    | sign0           | 1    | 左操作数(rs0)符号 | 0=无符号, 1=有符号          |
| [52]    | sign1           | 1    | 右操作数(rs1)符号 | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_input  | 2    | 输入位宽          | 00=8bit, 01=16bit, 10=32bit |
| [49:48] | bitwidth_output | 2    | 输出位宽          | 00=8bit, 01=16bit, 10=32bit |
| [47:42] | shift_width     | 6    | 右移位宽          | 0~63                        |
| [36:32] | rs1             | 5    | 源寄存器地址      | 0~31                        |
| [31:0]  | imm             | 32   | 立即数            | 0x00000000~0xFFFFFFFF       |

**功能**: `rs1 = imm * rs1 >> shift_width` (原地更新rs1)

------

#### **SQRT指令** (opcode=0b011010, PEx专用)

| Bit位   | 名称           | 宽度 | 说明           | 编码值                      |
| ------- | -------------- | ---- | -------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码         | 0b011010                    |
| [51:50] | bitwidth_input | 2    | 输入位宽       | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd             | 5    | 目标寄存器地址 | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址   | 0~31                        |

**功能**: `rd = sqrt(rs)` (平方根)

------

#### **ADDx指令** (opcode=0b011011, PEx专用)

| Bit位   | 名称            | 宽度 | 说明               | 编码值                      |
| ------- | --------------- | ---- | ------------------ | --------------------------- |
| [59:54] | opcode          | 6    | 操作码             | 0b011011                    |
| [53]    | sign0           | 1    | 左操作数(rs0)符号  | 0=无符号, 1=有符号          |
| [52]    | sign1           | 1    | 右操作数(rs1)符号  | 0=无符号, 1=有符号          |
| [51:50] | bitwidth_rs0    | 2    | 左操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [49:48] | bitwidth_rs1    | 2    | 右操作数位宽       | 00=8bit, 01=16bit, 10=32bit |
| [41:40] | bitwidth_output | 2    | 输出位宽           | 00=8bit, 01=16bit, 10=32bit |
| [34:30] | rd              | 5    | 目标寄存器地址     | 0~31                        |
| [9:5]   | rs1             | 5    | 右操作数寄存器地址 | 0~31                        |
| [4:0]   | rs0             | 5    | 左操作数寄存器地址 | 0~31                        |

**功能**: `rd = rs0 + rs1` (与ADD相同，但不支持进位保留和带进位功能)

------

#### **SHIFTx指令** (opcode=0b011100, PEx专用)

| Bit位   | 名称           | 宽度 | 说明           | 编码值                      |
| ------- | -------------- | ---- | -------------- | --------------------------- |
| [59:54] | opcode         | 6    | 操作码         | 0b011100                    |
| [53]    | sign           | 1    | 操作数符号     | 0=无符号, 1=有符号          |
| [52]    | 0              | 1    | 固定为0        | 0                           |
| [51:50] | bitwidth_input | 2    | 输入位宽       | 00=8bit, 01=16bit, 10=32bit |
| [48:47] | RND            | 2    | 舍入方式       | 00=floor, 01=nearest        |
| [46:42] | shift_width    | 5    | 移位宽度       | 0~31                        |
| [34:30] | rd             | 5    | 目标寄存器地址 | 0~31                        |
| [4:0]   | rs             | 5    | 源寄存器地址   | 0~31                        |

**功能**: `rd = rs >> shift_width` (仅支持右移)

------